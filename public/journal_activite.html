<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Interface Sportive</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind compil√© (utilise tailwind.config.js) -->
  <link rel="stylesheet" href="./output.css" />
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Font Awesome pour les ic√¥nes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* Supprime les marges par d√©faut du body et html */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      overflow-x: hidden;
    }
    
    /* Styles pour la carte */
    #map {
      width: 100%;
      height: 100%;
      z-index: 1;
      border-radius: 10px;
    }
    
    /* Style pour le bouton de localisation */
    .leaflet-control-locate {
      background: white;
      border: 2px solid rgba(0,0,0,0.2);
      border-radius: 4px;
      width: 34px;
      height: 34px;
      line-height: 30px;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 1px 5px rgba(0,0,0,0.4);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Masquer l'input file par d√©faut */
    .file-input {
      display: none;
    }
    
    /* Style pour la pr√©visualisation */
    .preview-container {
      position: relative;
      overflow: hidden;
    }
    
    .preview-image, .preview-video {
      max-width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 8px;
    }
    
    .remove-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      color: #E74C3C;
      border: none;
    }
    
    /* Style pour l'emoji s√©lectionn√© */
    .emoji-selected {
      background: linear-gradient(to bottom right, #FF6B35, #E74C3C) !important;
      color: white !important;
      border-color: #E74C3C !important;
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
    }
    
    /* Styles personnalis√©s pour am√©liorer le responsive */
    @media (max-width: 640px) {
      .nav-buttons {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .nav-button {
        flex: 1 0 auto;
        min-width: 140px;
      }
    }
  </style>
  
  <script>
    // Variable pour stocker l'emoji s√©lectionn√©
    let selectedEmoji = 'üòä'; // Valeur par d√©faut
    
    // Variables pour la carte
    let map = null;
    let userMarker = null;
    let userLocation = null;
    
    // Fonction pour mettre √† jour la valeur RPE
    function updateRPEValue() {
      const rpeSlider = document.getElementById('rpeSlider');
      const rpeValue = document.getElementById('rpeValue');
      
      rpeValue.textContent = `Niveau s√©lectionn√© : ${rpeSlider.value}`;
    }
    
    // Fonction pour s√©lectionner un emoji
    function selectEmoji(emoji, element) {
      // R√©initialiser tous les emojis
      const allEmojis = document.querySelectorAll('.emoji-btn');
      allEmojis.forEach(btn => {
        btn.classList.remove('emoji-selected');
        btn.classList.remove('text-white');
        btn.classList.add('bg-white');
        btn.classList.add('text-[#0A1F2F]');
        // R√©initialiser le d√©grad√© pour les boutons non s√©lectionn√©s
        btn.style.background = '';
      });
      
      // Appliquer le style s√©lectionn√© √† l'emoji cliqu√©
      element.classList.add('emoji-selected');
      element.classList.add('text-white');
      element.classList.remove('bg-white');
      element.classList.remove('text-[#0A1F2F]');
      
      // Stocker l'emoji s√©lectionn√©
      selectedEmoji = emoji;
      
      console.log(`Emoji s√©lectionn√© : ${selectedEmoji}`);
    }
    
    // Fonction pour g√©rer la s√©lection de fichiers
    function handleFileSelect(event) {
      const fileInput = event.target;
      const file = fileInput.files[0];
      const previewContainer = document.getElementById('previewContainer');
      const fileLabel = document.getElementById('fileLabel');
      
      if (file) {
        // V√©rifier le type de fichier
        const validImageTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
        const validVideoTypes = ['video/mp4', 'video/webm', 'video/ogg'];
        
        const isImage = validImageTypes.includes(file.type);
        const isVideo = validVideoTypes.includes(file.type);
        const isGif = file.type === 'image/gif';
        
        if (isImage || isVideo || isGif) {
          // Cr√©er un objet URL pour la pr√©visualisation
          const objectURL = URL.createObjectURL(file);
          
          // Afficher la pr√©visualisation
          if (isImage || isGif) {
            previewContainer.innerHTML = `
              <img src="${objectURL}" alt="Pr√©visualisation" class="preview-image">
              <button type="button" onclick="removeFile()" class="remove-btn">√ó</button>
            `;
          } else if (isVideo) {
            previewContainer.innerHTML = `
              <video controls class="preview-video">
                <source src="${objectURL}" type="${file.type}">
                Votre navigateur ne supporte pas la lecture de vid√©os.
              </video>
              <button type="button" onclick="removeFile()" class="remove-btn">√ó</button>
            `;
          }
          
          // Changer le label
          fileLabel.innerHTML = `
            <div class="text-center">
              <div class="text-green-600 text-lg mb-1">‚úì</div>
              <div class="font-semibold">Fichier s√©lectionn√©</div>
              <div class="text-xs text-gray-500 mt-1">${file.name}</div>
              <div class="text-xs text-gray-500">${(file.size / 1024 / 1024).toFixed(2)} MB</div>
              <div class="text-xs text-blue-600 mt-2">Cliquez pour changer</div>
            </div>
          `;
          
          // Stocker le nom du fichier pour l'affichage
          document.getElementById('fileName').textContent = file.name;
        } else {
          alert('Format de fichier non support√©. Veuillez s√©lectionner une image (JPG, PNG, GIF) ou une vid√©o (MP4, WebM).');
          fileInput.value = '';
        }
      }
    }
    
    // Fonction pour supprimer le fichier s√©lectionn√©
    function removeFile() {
      const fileInput = document.getElementById('fileInput');
      const previewContainer = document.getElementById('previewContainer');
      const fileLabel = document.getElementById('fileLabel');
      
      // R√©initialiser l'input file
      fileInput.value = '';
      
      // R√©initialiser la pr√©visualisation
      previewContainer.innerHTML = '';
      
      // R√©initialiser le label
      fileLabel.innerHTML = `
        <span class="text-3xl md:text-4xl lg:text-5xl text-[#FF6B35] mb-1 md:mb-2">+</span>
        <span class="font-semibold text-center text-sm md:text-base lg:text-lg">Ajouter Vid√©o / GIF / Image</span>
        <span class="text-xs text-gray-500 mt-2">(MP4, JPG, PNG, GIF)</span>
      `;
      
      // R√©initialiser le nom du fichier
      document.getElementById('fileName').textContent = 'Aucun fichier s√©lectionn√©';
    }
    
    // Fonction pour ouvrir le s√©lecteur de fichiers
    function openFileSelector() {
      document.getElementById('fileInput').click();
    }
    
    // ============================================
    // FONCTIONS POUR LA CARTE
    // ============================================
    
    // Initialiser la carte
    function initMap() {
      // Coordonn√©es par d√©faut (Paris)
      const defaultCenter = [48.8566, 2.3522];
      
      // Cr√©er la carte
      map = L.map('map').setView(defaultCenter, 13);
      
      // Ajouter la couche OpenStreetMap
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);
      
      // Ajouter un bouton de localisation personnalis√©
      const locateButton = L.control({ position: 'topright' });
      locateButton.onAdd = function() {
        const btn = L.DomUtil.create('button', 'leaflet-control-locate');
        btn.innerHTML = 'üìç';
        btn.title = "Trouver ma position";
        btn.onclick = function(e) {
          e.stopPropagation();
          findMyLocation();
        };
        return btn;
      };
      locateButton.addTo(map);
      
      // Ajouter un marqueur par d√©faut
      userMarker = L.marker(defaultCenter)
        .addTo(map)
        .bindPopup("Carte GPS de votre activit√©<br>Cliquez sur üìç pour votre position")
        .openPopup();
    }
    
    // Trouver la position de l'utilisateur
    function findMyLocation() {
      if (!navigator.geolocation) {
        alert("La g√©olocalisation n'est pas support√©e par votre navigateur.");
        return;
      }
      
      // Afficher un message de chargement
      if (userMarker) {
        userMarker.bindPopup("Recherche de votre position...").openPopup();
      }
      
      // Demander la position
      navigator.geolocation.getCurrentPosition(
        // Succ√®s
        function(position) {
          userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          
          // Centrer la carte sur la position
          map.setView([userLocation.lat, userLocation.lng], 15);
          
          // Supprimer l'ancien marqueur et en cr√©er un nouveau
          if (userMarker) map.removeLayer(userMarker);
          
          userMarker = L.marker([userLocation.lat, userLocation.lng])
            .addTo(map)
            .bindPopup("<b>Vous √™tes ici !</b><br>Position actuelle d√©tect√©e.")
            .openPopup();
            
          console.log("Position trouv√©e :", userLocation);
          
          // Mettre √† jour le statut
          document.getElementById('locationStatus').textContent = "Position d√©tect√©e";
          document.getElementById('locationStatus').classList.remove('text-gray-500');
          document.getElementById('locationStatus').classList.add('text-green-600');
        },
        // Erreur
        function(error) {
          let errorMsg = "Impossible d'obtenir votre position. ";
          switch(error.code) {
            case error.PERMISSION_DENIED:
              errorMsg += "Vous avez refus√© la demande de g√©olocalisation.";
              break;
            case error.POSITION_UNAVAILABLE:
              errorMsg += "Les informations de localisation ne sont pas disponibles.";
              break;
            case error.TIMEOUT:
              errorMsg += "La demande de localisation a expir√©.";
              break;
            default:
              errorMsg += "Une erreur inconnue s'est produite.";
          }
          alert(errorMsg);
          
          // Mettre √† jour le statut
          document.getElementById('locationStatus').textContent = "Position non disponible";
          document.getElementById('locationStatus').classList.remove('text-gray-500');
          document.getElementById('locationStatus').classList.add('text-red-600');
        },
        // Options
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    }
    
    // ============================================
    // INITIALISATION DE LA PAGE
    // ============================================
    
    function initializePage() {
      // Initialiser la valeur RPE
      updateRPEValue();
      
      // S√©lectionner l'emoji par d√©faut au chargement
      const defaultEmoji = document.querySelector('[data-emoji="üòä"]');
      if (defaultEmoji) {
        selectEmoji('üòä', defaultEmoji);
      }
      
      // Initialiser la carte
      initMap();
    }
    
    // Initialiser la page quand elle est charg√©e
    window.addEventListener('DOMContentLoaded', initializePage);
    
  </script>
</head>

<body class="min-h-screen w-full bg-white font-sans text-[#0A1F2F]">

<!-- ======================================================
  JOURNAL D'ACTIVIT√â
====================================================== -->
<section class="w-full min-h-screen bg-white
              grid grid-rows-[auto_1fr] overflow-hidden">

<!-- ================= HEADER ================= -->
<header class="bg-gradient-to-r from-[#0A1F2F] to-[#1A3B5A] text-white">
  <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">

    <!-- Logo -->
    <div class="flex items-center gap-3">
      <img src="./assets/img/logo.png"
       class="h-16 w-16 md:h-20 md:w-20" alt="Logo">
      <span class="font-bold text-lg">ESPRITFIT</span>
    </div>

    <!-- Navigation -->
    <nav class="hidden md:flex gap-3 items-center">
      <a href="./index.html" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Accueil</a>
      <a href="./calendrier.html" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Calendrier</a>

      <!-- Dropdown Suivi Progression -->
      <div class="relative group">
        <button type="button" data-nav-button="suivi" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition flex items-center gap-2">
          Suivi Progression
          <i class="fas fa-chevron-down text-sm"></i>
        </button>

        <!-- Menu d√©roulant -->
        <div class="absolute top-full left-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
          <div class="py-2">
            <a href="./suivi_progression.html" class="block px-4 py-3 text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors">
              <div class="flex items-center gap-3">
                <i class="fas fa-chart-line text-orange-500"></i>
                <span class="font-medium">Mon Suivi</span>
              </div>
            </a>
            <a href="./journal_activite.html" class="block px-4 py-3 text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors">
              <div class="flex items-center gap-3">
                <i class="fas fa-book text-orange-500"></i>
                <span class="font-medium">Journal d'Activit√©</span>
              </div>
            </a>
            <a href="./recompense.html" class="block px-4 py-3 text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors">
              <div class="flex items-center gap-3">
                <i class="fas fa-trophy text-orange-500"></i>
                <span class="font-medium">R√©compenses</span>
              </div>
            </a>
            <a href="./chatCoach.html" class="block px-4 py-3 text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors">
              <div class="flex items-center gap-3">
                <i class="fas fa-comments text-orange-500"></i>
                <span class="font-medium">Chat Coach</span>
              </div>
            </a>
            <a href="./objectifs.html" class="block px-4 py-3 text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors">
              <div class="flex items-center gap-3">
                <i class="fas fa-bullseye text-orange-500"></i>
                <span class="font-medium">Objectifs</span>
              </div>
            </a>
            <a href="./programme.html" class="block px-4 py-3 text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors">
              <div class="flex items-center gap-3">
                <i class="fas fa-dumbbell text-orange-500"></i>
                <span class="font-medium">Programme</span>
              </div>
            </a>
            <a href="./workspace.html" class="block px-4 py-3 text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors">
              <div class="flex items-center gap-3">
                <i class="fas fa-briefcase text-orange-500"></i>
                <span class="font-medium">Workspace</span>
              </div>
            </a>
          </div>
        </div>
      </div>

      <!-- Dropdown Activit√©s sportif -->
      <div class="relative group">
        <button type="button" data-nav-button="activites" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition flex items-center gap-2">
          Activit√©s sportif
          <i class="fas fa-chevron-down text-sm"></i>
        </button>

        <div class="absolute top-full left-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
          <div class="py-2">
            <a href="./interface1.html" class="block px-4 py-3 text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors">Choix de niveau</a>
                <a href="./confirmationInfo.html" class="block px-4 py-3 text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors">Confirmation Info</a>
                <a href="./choixActiv.html" class="block px-4 py-3 text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors">Choix Activ</a>
                <a href="./modeSportif.html" class="block px-4 py-3 text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors">Mode Sportif</a>
          </div>
        </div>
      </div>

      <a href="./profil.html" data-nav-link="profil" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Profil</a>
    </nav>

    <!-- Menu mobile hamburger -->
    <button id="mobileMenuButton" type="button" class="md:hidden text-white text-2xl" aria-controls="mobileMenu" aria-expanded="false" aria-label="Ouvrir le menu">
      <i class="fas fa-bars"></i>
    </button>
  </div>
</header>

<!-- Menu mobile -->
<div id="mobileMenu" class="md:hidden hidden bg-[#0A1F2F] text-white border-t border-white/10">
  <div class="max-w-7xl mx-auto px-6 py-4 flex flex-col gap-2">
    <a href="./index.html" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Accueil</a>
    <a href="./calendrier.html" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Calendrier</a>
    <div class="pt-3 mt-2 border-t border-white/10">
      <button
        type="button"
        class="w-full px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition flex items-center justify-between"
        data-nav-mobile-button="suivi"
        data-mobile-accordion-button
        aria-expanded="false"
        aria-controls="mobileSubmenuSuivi"
      >
        <span class="text-sm font-semibold opacity-90">Suivi Progression</span>
        <i class="fas fa-chevron-down text-sm transition-transform" data-mobile-accordion-icon></i>
      </button>

      <div id="mobileSubmenuSuivi" class="hidden mt-2" data-mobile-accordion-panel>
        <a href="./suivi_progression.html" class="block px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Mon Suivi</a>
        <a href="./journal_activite.html" class="mt-2 block px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Journal d'Activit√©</a>
        <a href="./recompense.html" class="mt-2 block px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">R√©compenses</a>
        <a href="./chatCoach.html" class="mt-2 block px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Chat Coach</a>
        <a href="./objectifs.html" class="mt-2 block px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Objectifs</a>
        <a href="./programme.html" class="mt-2 block px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Programme</a>
        <a href="./workspace.html" class="mt-2 block px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Workspace</a>
      </div>
    </div>

    <div class="pt-3 mt-2 border-t border-white/10">
      <button
        type="button"
        class="w-full px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition flex items-center justify-between"
        data-nav-mobile-button="activites"
        data-mobile-accordion-button
        aria-expanded="false"
        aria-controls="mobileSubmenuActivites"
      >
        <span class="text-sm font-semibold opacity-90">Activit√©s sportif</span>
        <i class="fas fa-chevron-down text-sm transition-transform" data-mobile-accordion-icon></i>
      </button>

      <div id="mobileSubmenuActivites" class="hidden mt-2" data-mobile-accordion-panel>
        <a href="./interface1.html" class="block px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Choix de niveau</a>
            <a href="./confirmationInfo.html" class="mt-2 block px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Confirmation Info</a>
            <a href="./choixActiv.html" class="mt-2 block px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Choix Activ</a>
            <a href="./modeSportif.html" class="mt-2 block px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Mode Sportif</a>
      </div>
    </div>
    <a href="./profil.html" data-nav-link="profil" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Profil</a>
  </div>
</div>

<!-- ================= CONTENU ================= -->
<div class="p-4 md:p-6 lg:p-10 bg-white overflow-y-auto h-full">

  <!-- TITRE -->
  <h2 class="text-2xl md:text-3xl lg:text-4xl font-extrabold text-center mb-8 md:mb-10 lg:mb-12 relative
             after:content-[''] after:absolute after:-bottom-2 md:after:-bottom-3 lg:after:-bottom-4
             after:left-1/2 after:-translate-x-1/2
             after:w-16 md:after:w-18 lg:after:w-20 after:h-0.5 md:after:h-1 after:rounded
             after:bg-gradient-to-r from-[#FF6B35] to-[#E74C3C]">
    Ma s√©ance d'Aujourd'hui
  </h2>

  <!-- FORMULAIRE -->
  <div class="w-full max-w-full md:max-w-[90%] lg:max-w-[800px] mx-auto flex flex-col gap-4 md:gap-5 lg:gap-6">

    <!-- TYPE DE SPORT -->
    <input type="text" placeholder="Type de sport"
           class="w-full px-4 py-3 md:px-5 md:py-4 border-2 border-[#D0D8E0] rounded-lg
                  text-[#0A1F2F] bg-white
                  focus:outline-none focus:border-[#FF6B35]
                  focus:ring-4 focus:ring-orange-500/10 transition
                  text-sm md:text-base">

    <!-- RPE -->
    <div class="w-full">
      <p class="font-semibold mb-2 md:mb-3 text-sm md:text-base">Effort Per√ßu (RPE)</p>

      <div class="flex flex-col md:flex-row items-center gap-2 md:gap-4 w-full">
        <span class="text-xs md:text-sm font-medium">1 (Tr√®s facile)</span>

        <input type="range" min="1" max="10" value="5" id="rpeSlider"
               oninput="updateRPEValue()"
               class="w-full h-2 rounded-lg cursor-pointer
                      bg-gradient-to-r from-[#D0D8E0]
                      via-[#FF6B35] to-[#E74C3C]">

        <span class="text-xs md:text-sm font-medium">10 (Maximal)</span>
      </div>

      <div class="mt-2 md:mt-3 font-bold text-center">
        <p id="rpeValue" class="text-[#FF6B35] text-sm md:text-base">
          Niveau s√©lectionn√© : 5
        </p>
      </div>
    </div>

    <!-- HUMEUR -->
    <div class="w-full">
      <p class="font-semibold mb-2 md:mb-3 text-sm md:text-base">Comment te sens-tu ?</p>

      <div class="flex flex-wrap justify-center gap-2 md:gap-3 lg:gap-4 w-full">
        <button type="button" 
                data-emoji="üôÇ"
                onclick="selectEmoji('üôÇ', this)"
                class="emoji-btn text-xl md:text-2xl px-3 py-2 md:px-4 md:py-3 lg:px-5 lg:py-3 border-2 border-[#D0D8E0]
                       rounded-lg md:rounded-xl bg-white text-[#0A1F2F]
                       hover:scale-110 hover:border-[#FF6B35] transition flex-1 min-w-[70px]">
          üôÇ
        </button>

        <button type="button" 
                data-emoji="üòä"
                onclick="selectEmoji('üòä', this)"
                class="emoji-btn text-xl md:text-2xl px-3 py-2 md:px-4 md:py-3 lg:px-5 lg:py-3 border-2 border-[#D0D8E0]
                       rounded-lg md:rounded-xl bg-white text-[#0A1F2F]
                       hover:scale-110 hover:border-[#FF6B35] transition flex-1 min-w-[70px]">
          üòä
        </button>

        <button type="button" 
                data-emoji="üòê"
                onclick="selectEmoji('üòê', this)"
                class="emoji-btn text-xl md:text-2xl px-3 py-2 md:px-4 md:py-3 lg:px-5 lg:py-3 border-2 border-[#D0D8E0]
                       rounded-lg md:rounded-xl bg-white text-[#0A1F2F]
                       hover:scale-110 hover:border-[#FF6B35] transition flex-1 min-w-[70px]">
          üòê
        </button>

        <button type="button" 
                data-emoji="üòî"
                onclick="selectEmoji('üòî', this)"
                class="emoji-btn text-xl md:text-2xl px-3 py-2 md:px-4 md:py-3 lg:px-5 lg:py-3 border-2 border-[#D0D8E0]
                       rounded-lg md:rounded-xl bg-white text-[#0A1F2F]
                       hover:scale-110 hover:border-[#FF6B35] transition flex-1 min-w-[70px]">
          üòî
        </button>
      </div>
      
   
    </div>

    <!-- MAP / VIDEO -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5 my-3 md:my-4 w-full">

      <!-- CARTE INTERACTIVE -->
      <div class="min-h-[120px] md:min-h-[150px] lg:min-h-[180px] border-2 border-[#D0D8E0] rounded-xl p-2">
        <div id="map" class="h-full w-full"></div>
        <div class="mt-2 text-center">
          <p id="locationStatus" class="text-xs text-gray-500">Cliquez sur üìç pour votre position</p>
        </div>
      </div>

      <!-- INPUT FICHIER AVEC PR√âVISUALISATION -->
      <div class="min-h-[120px] md:min-h-[150px] lg:min-h-[180px] relative">
        <!-- Input file cach√© -->
        <input type="file" 
               id="fileInput" 
               class="file-input"
               accept="image/*,video/*"
               onchange="handleFileSelect(event)">
        
        <!-- Zone de d√©p√¥t et de clic -->
        <div onclick="openFileSelector()"
             class="w-full h-full flex flex-col items-center justify-center
                    border-2 border-dashed border-[#FF6B35]
                    rounded-xl cursor-pointer
                    hover:bg-[#FFF5F0] hover:-translate-y-1 transition p-4">
          <div id="fileLabel" class="flex flex-col items-center justify-center">
            <span class="text-3xl md:text-4xl lg:text-5xl text-[#FF6B35] mb-1 md:mb-2">+</span>
            <span class="font-semibold text-center text-sm md:text-base lg:text-lg">Ajouter Vid√©o / GIF / Image</span>
            <span class="text-xs text-gray-500 mt-2">(MP4, JPG, PNG, GIF)</span>
          </div>
          
          <!-- Affichage du nom du fichier -->
          <div id="fileName" class="text-xs text-gray-600 mt-3 font-medium">
            Aucun fichier s√©lectionn√©
          </div>
        </div>
        
        <!-- Conteneur pour la pr√©visualisation -->
        <div id="previewContainer" class="preview-container mt-4"></div>
      </div>

    </div>
    
    <!-- INFORMATIONS FICHIER -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
      <p class="font-semibold text-blue-800 mb-2">üìÅ Formats accept√©s :</p>
      <ul class="text-sm text-blue-700 list-disc pl-5">
        <li>Images : JPG, PNG, GIF, WebP</li>
        <li>Vid√©os : MP4, WebM, OGG</li>
        <li>Taille maximale recommand√©e : 50MB</li>
      </ul>
    </div>

    <!-- BOUTON -->
  <!-- BOUTON -->
<button type="button" 
        id="validateBtn"
        onclick="openModal()"
        class="mt-3 md:mt-4 px-6 py-3 md:px-8 md:py-4 rounded-xl text-base md:text-lg lg:text-xl font-bold text-white
                  bg-gradient-to-br from-[#FF6B35] to-[#E74C3C]
                  shadow-[0_4px_12px_rgba(255,107,53,0.4)]
                  hover:-translate-y-1 hover:shadow-[0_6px_20px_rgba(255,107,53,0.5)]
                  transition w-full">
      Enregistrer et valider l'activit√©
</button>

  </div>
</div>


</section>

<!-- ============================================
     MODAL COACH (cach√© par d√©faut)
     ============================================ -->
<div id="coachModal" class="hidden fixed inset-0 z-[1000]">
  <!-- Overlay -->
  <div id="coachModalOverlay" class="absolute inset-0 bg-black/50"></div>

  <!-- Contenu du Modal -->
  <div class="relative min-h-screen flex items-center justify-center p-4">
    <div class="bg-white border-[3px] border-[#FF6B35] rounded-xl p-6 md:p-8
                shadow-[0_10px_40px_rgba(10,31,47,0.3)] w-[500px] max-w-[90%]">
      
      <!-- En-t√™te du Modal -->
      <div class="flex items-center justify-between mb-5 pb-4 border-b-2 border-[#D0D8E0]">
        <h4 class="text-[#0A1F2F] text-xl md:text-[1.4rem] font-bold">Conseil du coach</h4>
        <button type="button" id="closeCoachModal"
          class="text-[2rem] leading-none text-[#E74C3C] transition hover:text-[#FF6B35] hover:scale-110 cursor-pointer bg-transparent border-0"
          aria-label="Fermer">
          √ó
        </button>
      </div>

      <!-- Contenu du Modal -->
      <div class="text-[#0A1F2F] leading-relaxed mb-5">
        <p class="mb-3 text-base md:text-[1.05rem]">Bravo pour ta r√©gularit√© !</p>
        <p class="mb-3 text-base md: text-[1.05rem]">
          Pour progresser, ajoute 5 minutes √† la prochaine course ce jeudi. 
          Ou d√©place ta s√©ance de samedi si tu te sens fatigu√©.
        </p>
        <div class="text-center text-[2. 5rem] text-[#FF6B35] my-5">‚Üì</div>
      </div>

      <!-- Bouton d'action -->
      <a href="./programme.html"><button type="button" id="adjustProgramBtn" class="w-full py-3 md:py-4 rounded-lg font-bold text-base md:text-[1.1rem] text-white
                     bg-gradient-to-b from-[#0A1F2F] to-[#1A3B5A] transition
                     hover:-translate-y-0.5 hover:shadow-[0_4px_12px_rgba(10,31,47,0.3)]">
        Ajuster mon programme
      </button></a>

      <!-- Footer du Modal -->
      <p class="mt-6 md:mt-9 text-center italic text-xs md:text-sm text-[#0A1F2F] pt-5 border-t-2 border-dashed border-[#D0D8E0]">
        Conseils personnalis√©s
      </p>
    </div>
  </div>
</div>

<!-- Leaflet JavaScript (√† charger apr√®s le DOM) -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet. js" 
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
        crossorigin=""></script>
<script>
  // ============================================
  // FONCTIONS SUPPL√âMENTAIRES
  // ============================================
  
  // Fonction pour soumettre le formulaire
  function submitForm() {
    const sportType = document.querySelector('input[type="text"]').value;
    const rpeValue = document.getElementById('rpeSlider').value;
    
    // Pr√©parer les donn√©es
    const formData = {
      sport: sportType,
      rpe: rpeValue,
      mood: selectedEmoji,
      location: userLocation,
      timestamp: new Date().toISOString()
    };
    
    // Afficher les donn√©es dans la console
    console.log('=== Donn√©es du formulaire ===', formData);
    
    // Afficher une alerte avec les informations
    let locationInfo = "Non captur√©e";
    if (userLocation) {
      locationInfo = `Lat: ${userLocation.lat.toFixed(6)}, Lng: ${userLocation.lng.toFixed(6)}`;
    }
    
    alert(`‚úÖ Activit√© enregistr√©e !\n\nSport: ${sportType}\nRPE: ${rpeValue}\nHumeur: ${selectedEmoji}\nPosition: ${locationInfo}\n\nLes donn√©es ont √©t√© enregistr√©es dans la console.`);
    
    // Ici, vous pourriez ajouter l'envoi des donn√©es √† un serveur
    // fetch('/api/activities', { method: 'POST', body: JSON.stringify(formData) })
  }
  
  // Mettre √† jour l'affichage de l'emoji s√©lectionn√©
  function updateSelectedEmojiDisplay() {
    const display = document.getElementById('selectedEmojiDisplay');
    if (display) {
      display.textContent = selectedEmoji;
    }
  }
  
  // Modifier la fonction selectEmoji pour mettre √† jour l'affichage
  const originalSelectEmoji = selectEmoji;
  selectEmoji = function(emoji, element) {
    originalSelectEmoji(emoji, element);
    updateSelectedEmojiDisplay();
  };
  
  // Initialiser l'affichage de l'emoji
  document.addEventListener('DOMContentLoaded', function() {
    updateSelectedEmojiDisplay();
  });
  
  // Fonction pour d√©marrer le suivi GPS (optionnel - pour un trac√© complet)
  let watchId = null;
  let trackPoints = [];
  
  function startGPSTracking() {
    if (!navigator.geolocation) {
      alert("La g√©olocalisation n'est pas support√©e par votre navigateur.");
      return;
    }
    
    // Demander la permission
    if (confirm("D√©marrer le suivi GPS pour enregistrer votre parcours ?")) {
      watchId = navigator.geolocation.watchPosition(
        function(position) {
          const point = {
            lat: position.coords.latitude,
            lng: position.coords.longitude,
            timestamp: new Date().toISOString(),
            accuracy: position.coords.accuracy
          };
          
          trackPoints.push(point);
          
          // Ajouter le point √† la carte
          L.circle([point.lat, point.lng], {
            color: '#FF6B35',
            fillColor: '#FF6B35',
            fillOpacity: 0.5,
            radius: position.coords.accuracy
          }).addTo(map);
          
          // Mettre √† jour le statut
          document.getElementById('locationStatus').textContent = `Suivi actif - ${trackPoints.length} points`;
          document.getElementById('locationStatus').classList.remove('text-gray-500');
          document.getElementById('locationStatus').classList.add('text-green-600');
          
          console.log("Point GPS ajout√©:", point);
        },
        function(error) {
          alert("Erreur lors du suivi GPS: " + error.message);
          stopGPSTracking();
        },
        {
          enableHighAccuracy: true,
          maximumAge: 0,
          timeout: 5000
        }
      );
      
      alert("Suivi GPS d√©marr√© ! Votre parcours sera enregistr√©.");
    }
  }
  
  function stopGPSTracking() {
    if (watchId) {
      navigator.geolocation.clearWatch(watchId);
      watchId = null;
      
      // Cr√©er une ligne pour le trac√©
      if (trackPoints.length > 1) {
        const latLngs = trackPoints.map(p => [p.lat, p.lng]);
        const polyline = L.polyline(latLngs, {color: '#FF6B35'}).addTo(map);
        map.fitBounds(polyline.getBounds());
      }
      
      document.getElementById('locationStatus').textContent = `Suivi termin√© - ${trackPoints.length} points enregistr√©s`;
      console.log("Trac√© enregistr√©:", trackPoints);
    }
  }



  // FORMULAIRE
      const form = document.getElementById('sessionForm');
      if (form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('üìù Formulaire soumis - Ouverture du modal');
          openModal();
          return false;
        });
        console.log('‚úÖ √âv√©nement de soumission du formulaire ajout√©');
      } else {
        console.error('‚ùå Formulaire introuvable !');
      }
      
      // Bouton de fermeture du modal
      const closeBtn = document.getElementById('closeCoachModal');
      if (closeBtn) {
        closeBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          closeModal();
        });
        console.log('‚úÖ Bouton de fermeture initialis√©');
      }
      
      // Overlay du modal
      const overlay = document. getElementById('coachModalOverlay');
      if (overlay) {
        overlay.addEventListener('click', function(e) {
          e.stopPropagation();
          closeModal();
        });
        console.log('‚úÖ Overlay initialis√©');
      }

      function updateRPEValue() {
    const rpeSlider = document.getElementById('rpeSlider');
    const rpeValue = document.getElementById('rpeValue');
    if (rpeSlider && rpeValue) {
      rpeValue.textContent = `Niveau s√©lectionn√© : ${rpeSlider.value}`;
    }
  }
  
  function selectEmoji(emoji, element) {
    const allEmojis = document.querySelectorAll('.emoji-btn');
    allEmojis.forEach(btn => {
      btn.classList.remove('emoji-selected', 'text-white');
      btn.classList.add('bg-white', 'text-[#0A1F2F]');
      btn.style.background = '';
    });
    
    element.classList.add('emoji-selected', 'text-white');
    element.classList.remove('bg-white', 'text-[#0A1F2F]');
    
    selectedEmoji = emoji;
    
    const hiddenInput = document.getElementById('selectedMood');
    if (hiddenInput) {
      hiddenInput.value = emoji;
    }
    
    console.log('üòä Emoji s√©lectionn√© :', emoji);
  }
    // ============================================
  // FONCTIONS POUR LE MODAL
  // ============================================
  
  function openModal() {
    console.log('üéØ Tentative d\'ouverture du modal.. .');
    const modal = document.getElementById('coachModal');
    if (modal) {
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      console.log('‚úÖ Modal ouvert avec succ√®s ! ');
    } else {
      console.error('‚ùå Modal introuvable ! ');
    }
  }
  
  function closeModal() {
    console.log('üéØ Fermeture du modal...');
    const modal = document.getElementById('coachModal');
    if (modal) {
      modal.classList.add('hidden');
      document.body.style. overflow = 'auto';
      console.log('‚úÖ Modal ferm√© avec succ√®s !');
    }
  }
</script>
<!-- ================= FOOTER ================= -->
<footer class="bg-[#1A3B5A] text-white mt-16">
  <div class="max-w-7xl mx-auto px-6 py-8 grid grid-cols-1 md:grid-cols-2 gap-6">

    <div>
      <h3 class="font-bold text-lg font-montserrat">ESPRITFIT</h3>
      <p class="text-sm opacity-90 mt-2">
        Plateforme universitaire pour d√©couvrir, planifier et r√©server des activit√©s sportives.
      </p>
    </div>

    <div class="md:text-right">
      <p>Campus Esprit, Tunis</p>
      <p class="text-orange-400 font-semibold">sport@esprit.tn</p>
      <p class="font-semibold">71 000 000</p>
    </div>

  </div>
</footer>

<script>
(() => {
  const button = document.getElementById('mobileMenuButton');
  const menu = document.getElementById('mobileMenu');
  if (!button || !menu) return;

  const accordionButtons = Array.from(menu.querySelectorAll('[data-mobile-accordion-button]'));
  const closeAllAccordions = () => {
    accordionButtons.forEach((btn) => {
      const panelId = btn.getAttribute('aria-controls');
      const panel = panelId ? document.getElementById(panelId) : null;
      const icon = btn.querySelector('[data-mobile-accordion-icon]');
      panel?.classList.add('hidden');
      btn.setAttribute('aria-expanded', 'false');
      icon?.classList.remove('rotate-180');
    });
  };

  const closeMenu = () => {
    menu.classList.add('hidden');
    button.setAttribute('aria-expanded', 'false');
    closeAllAccordions();
  };

  const toggleMenu = () => {
    const isHidden = menu.classList.contains('hidden');
    if (isHidden) {
      menu.classList.remove('hidden');
      button.setAttribute('aria-expanded', 'true');
    } else {
      closeMenu();
    }
  };

  button.addEventListener('click', (event) => {
    event.stopPropagation();
    toggleMenu();
  });

  accordionButtons.forEach((btn) => {
    btn.addEventListener('click', (event) => {
      event.stopPropagation();
      const panelId = btn.getAttribute('aria-controls');
      if (!panelId) return;
      const panel = document.getElementById(panelId);
      if (!panel) return;
      const icon = btn.querySelector('[data-mobile-accordion-icon]');

      accordionButtons.forEach((otherBtn) => {
        if (otherBtn === btn) return;
        const otherPanelId = otherBtn.getAttribute('aria-controls');
        const otherPanel = otherPanelId ? document.getElementById(otherPanelId) : null;
        const otherIcon = otherBtn.querySelector('[data-mobile-accordion-icon]');
        otherPanel?.classList.add('hidden');
        otherBtn.setAttribute('aria-expanded', 'false');
        otherIcon?.classList.remove('rotate-180');
      });

      const isHidden = panel.classList.contains('hidden');
      if (isHidden) {
        panel.classList.remove('hidden');
        btn.setAttribute('aria-expanded', 'true');
        icon?.classList.add('rotate-180');
      } else {
        panel.classList.add('hidden');
        btn.setAttribute('aria-expanded', 'false');
        icon?.classList.remove('rotate-180');
      }
    });
  });

  document.addEventListener('click', (event) => {
    if (menu.classList.contains('hidden')) return;
    if (menu.contains(event.target) || button.contains(event.target)) return;
    closeMenu();
  });

  window.addEventListener('resize', () => {
    if (window.innerWidth >= 768) closeMenu();
  });
})();

// Surlignage orange du menu actif (desktop + mobile)
(() => {
  const currentFile = (window.location.pathname.split('/').pop() || '').trim() || 'index.html';

  const suiviPages = new Set([
    'suivi_progression.html',
    'journal_activite.html',
    'recompense.html',
    'chatCoach.html',
    'objectifs.html',
    'programme.html',
    'workspace.html',
  ]);
  const activitesPages = new Set([
    'interface1.html',
    'interface2.html',
    'interface3.html',
    'interface4.html',
    'interface5(doua).html',
        'confirmationInfo.html',
        'choixActiv.html',
        'modeSportif.html',
  ]);

  const makeOrange = (el) => {
    if (!el) return;
    el.classList.remove('bg-white/10', 'hover:bg-white/20');
    el.classList.add(
      'bg-gradient-to-r',
      'from-orange-500',
      'to-red-500',
      'font-bold',
      'shadow-[0px_6px_20px_0px_rgba(255,107,53,0.40)]',
      'hover:opacity-90'
    );
  };

  const clearOrange = (el) => {
    if (!el) return;
    el.classList.remove(
      'bg-gradient-to-r',
      'from-orange-500',
      'to-red-500',
      'font-bold',
      'shadow-[0px_6px_20px_0px_rgba(255,107,53,0.40)]',
      'hover:opacity-90'
    );
    if (!el.classList.contains('bg-white/10')) el.classList.add('bg-white/10');
    if (!el.classList.contains('hover:bg-white/20')) el.classList.add('hover:bg-white/20');
  };

  const suiviButtons = document.querySelectorAll('[data-nav-button="suivi"], [data-nav-mobile-button="suivi"]');
  const activitesButtons = document.querySelectorAll('[data-nav-button="activites"], [data-nav-mobile-button="activites"]');
  const profilButtons = document.querySelectorAll('[data-nav-link="profil"]');

  suiviButtons.forEach(clearOrange);
  activitesButtons.forEach(clearOrange);
  profilButtons.forEach(clearOrange);

  if (currentFile === 'profil.html') {
    profilButtons.forEach(makeOrange);
  } else if (suiviPages.has(currentFile)) {
    suiviButtons.forEach(makeOrange);
  } else if (activitesPages.has(currentFile)) {
    activitesButtons.forEach(makeOrange);
  }
})();
</script>
</body>
</html>