<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ESPRITFIT – Calendrier</title>
    <script src="https://cdn.tailwindcss.com"></script> <!-- [web:56] -->
  </head>

  <body class="font-sans text-gray-800">
    <!-- HEADER -->
    <header class="bg-[#1a3b5a] px-20 py-4 flex items-center justify-between">
      <div class="text-white font-bold text-xl">
        <img src="../assets/images/logo.png" alt="logo" class="h-16 w-auto" />
      </div>

      <nav class="space-x-8 text-white">
        <a href="index.html" class="hover:text-orange-400 transition">Accueil</a>
        <a href="calendrier.html" class="border-b-2 border-orange-400 pb-1 text-orange-400">
          Calendrier
        </a>
        <a href="#" class="hover:text-orange-400 transition">Mes activités</a>
      </nav>

      <a
        href="#"
        class="bg-gradient-to-r from-orange-500 to-red-500
               text-white px-6 py-2 rounded-lg font-semibold
               shadow-lg hover:scale-105 hover:shadow-xl
               transition duration-300"
      >
        Connexion
      </a>
    </header>

    <!-- EN-TÊTE CALENDRIER -->
    <section class="bg-[#f4f4f4] py-16">
      <div class="max-w-5xl mx-auto bg-white rounded-xl shadow-sm px-10 py-8">
        <div class="flex items-center justify-center gap-6 mb-2">
          <button
            type="button"
            aria-label="Mois précédent"
            id="prev-month"
            class="flex h-8 w-8 items-center justify-center rounded-full bg-[#1a3b5a] text-white hover:bg-orange-500 transition"
          >
            ←
          </button>

          <h1 id="month-label" class="text-xl font-bold text-[#1a3b5a]">
            <!-- rempli par JS -->
          </h1>

          <button
            type="button"
            aria-label="Mois suivant"
            id="next-month"
            class="flex h-8 w-8 items-center justify-center rounded-full bg-[#1a3b5a] text-white hover:bg-orange-500 transition"
          >
            →
          </button>
        </div>

        <p id="current-time" class="mt-1 text-center text-xs text-gray-500"></p>

        <p class="mt-3 text-center text-sm text-gray-600 max-w-2xl mx-auto">
          Découvrez toutes les activités prévues à l'université et planifiez vos séances en fonction de votre emploi du
          temps.
        </p>
      </div>

      <!-- BARRE FILTRE AU-DESSUS DU CALENDRIER -->
      <div class="max-w-5xl mx-auto mt-4 flex justify-end px-2">
        <a
          href="filtre.html"
          class="inline-flex items-center gap-2 text-sm font-medium text-[#1a3b5a] bg-white border border-gray-200 rounded-full px-4 py-2 shadow-sm hover:bg-orange-50 hover:border-orange-400 transition"
        >
          <!-- Icône filtre (SVG simple) -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-orange-500" viewBox="0 0 20 20" fill="currentColor">
            <path
              fill-rule="evenodd"
              d="M3 4a1 1 0 011-1h12a1 1 0 01.8 1.6L12 11.25V16a1 1 0 01-1.447.894l-2-1A1 1 0 018 15v-3.75L3.2 4.6A1 1 0 013 4z"
              clip-rule="evenodd"
            />
          </svg>
          <span>Filtrer les activités</span>
        </a>
      </div>

      <!-- CALENDRIER -->
      <main class="max-w-5xl mx-auto mt-4 bg-[#f3f3f3] rounded-xl border border-gray-200 p-6">
        <div class="grid grid-cols-7 text-center text-xs font-semibold text-gray-500 mb-4">
          <div>LUN</div>
          <div>MAR</div>
          <div>MER</div>
          <div>JEU</div>
          <div>VEN</div>
          <div>SAM</div>
          <div>DIM</div>
        </div>

        <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-sm"></div>
      </main>
    </section>

    <!-- BOUTON FILTRE FLOTTANT (SI TU VEUX LE GARDER) -->
    <button
      type="button"
      aria-label="Filtrer les activités"
      class="fixed bottom-8 right-10 flex h-12 w-12 items-center justify-center rounded-full bg-orange-400 text-white shadow-lg hover:bg-orange-500 transition"
      onclick="window.location.href='filtre.html'"
    >
      <span class="h-5 w-5 rounded-sm border-2 border-white"></span>
    </button>

    <!-- FOOTER -->
    <footer class="bg-[#1a3b5a] text-white px-20 py-10 flex flex-col md:flex-row justify-between gap-8">
      <div>
        <h4 class="font-bold text-lg">ESPRITFIT</h4>
        <p class="opacity-90 max-w-sm">
          Plateforme universitaire pour découvrir, planifier et réserver des activités sportives.
        </p>
      </div>

      <div class="text-right">
        <p>Campus Esprit, Tunis</p>
        <a href="mailto:sport@esprit.tn" class="text-orange-400 hover:underline">
          sport@esprit.tn
        </a>
        <p>71 000 000</p>
      </div>
    </footer>

    <!-- SCRIPT CALENDRIER + ACTIVITÉS -->
    <script>
      const monthLabel = document.getElementById("month-label");
      const grid = document.getElementById("calendar-grid");
      const prevBtn = document.getElementById("prev-month");
      const nextBtn = document.getElementById("next-month");
      const timeLabel = document.getElementById("current-time");

      // Décembre 2025 (11 = décembre)
      let current = new Date(2025, 11, 1);

      // date à partir de laquelle les activités sont possibles
      const activityStart = new Date(2025, 11, 1);

      // activités à partir de cette date
      const activities = {
        "2025-12-12": [{ title: "Football", time: "14h-15h30", sport: "football" }],
        "2025-12-15": [{ title: "Yoga", time: "16h-17h", sport: "yoga", full: true }],
        "2025-12-18": [{ title: "Football", time: "14h-15h30", sport: "football" }],
        "2025-12-24": [
          { title: "Yoga", time: "10h-11h", sport: "yoga" },
          { title: "Tennis", time: "14h-15h", sport: "tennis" },
        ],
        "2025-12-29": [
          { title: "Natation", time: "10h-11h", sport: "natation" },
          { title: "Football", time: "18h-19h", sport: "football" },
        ],
        "2025-12-31": [
          { title: "Musculation", time: "12h-13h", sport: "musculation" },
        ],
      };

      const monthNames = [
        "Janvier",
        "Février",
        "Mars",
        "Avril",
        "Mai",
        "Juin",
        "Juillet",
        "Août",
        "Septembre",
        "Octobre",
        "Novembre",
        "Décembre",
      ];

      function isSameDate(d1, d2) {
        return (
          d1.getFullYear() === d2.getFullYear() &&
          d1.getMonth() === d2.getMonth() &&
          d1.getDate() === d2.getDate()
        );
      }

      function isBeforeActivityStart(date) {
        const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
        const s = new Date(
          activityStart.getFullYear(),
          activityStart.getMonth(),
          activityStart.getDate()
        );
        return d < s;
      }

      function renderCalendar() {
        grid.innerHTML = "";

        const year = current.getFullYear();
        const month = current.getMonth();

        monthLabel.textContent = `${monthNames[month]} ${year}`;

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startWeekday = (firstDay.getDay() + 6) % 7; // 0 = LUN

        // cases vides avant le 1
        for (let i = 0; i < startWeekday; i++) {
          const cell = document.createElement("div");
          cell.className = "h-36";
          grid.appendChild(cell);
        }

        const today = new Date();

        for (let day = 1; day <= lastDay.getDate(); day++) {
          const date = new Date(year, month, day);
          const yyyy = year;
          const mm = String(month + 1).padStart(2, "0");
          const dd = String(day).padStart(2, "0");
          const isoDate = `${yyyy}-${mm}-${dd}`;

          const isToday = isSameDate(date, today);
          const beforeStart = isBeforeActivityStart(date);

          const cell = document.createElement("button");

          const baseClasses =
            "h-36 w-full text-left border border-gray-200 p-3 text-xs rounded-md transition cursor-pointer hover:shadow-sm";

          const todayClasses = isToday
            ? " border-orange-500 bg-orange-50 shadow-inner"
            : " bg-white";

          const pastClasses = beforeStart
            ? " bg-gray-100 text-gray-300 cursor-not-allowed"
            : "";

          cell.className = baseClasses + todayClasses + pastClasses;

          let inner = `
            <div class="flex items-start justify-between mb-1">
              <span>${day}</span>
              ${
                isToday
                  ? '<span class="px-2 py-[1px] rounded-full bg-orange-500 text-[10px] text-white font-semibold">AUJOURD\'HUI</span>'
                  : ""
              }
            </div>
          `;

          if (beforeStart) {
            inner += `<p class="mt-4 text-[11px] text-gray-300 text-center">
              Activités indisponibles avant cette date
            </p>`;
          } else {
            const dayActivities = activities[isoDate] || [];

            if (dayActivities.length > 0) {
              inner += `<div class="mt-1 flex flex-col gap-1">`;
              dayActivities.forEach((act) => {
                const fullBadge = act.full
                  ? '<span class="ml-1 rounded-full bg-gray-800 px-2 py-[1px] text-[9px] text-white">COMPLET</span>'
                  : "";
                inner += `
                  <div class="rounded-md border border-orange-100 bg-orange-50 px-2 py-[6px]">
                    <p class="text-[11px] font-semibold text-[#1a3b5a] flex items-center">
                      ${act.title}${fullBadge}
                    </p>
                    <p class="mt-1 inline-flex items-center gap-1 text-[10px] text-gray-700">
                      <span class="h-1 w-1 rounded-full bg-orange-400"></span>${act.time}
                    </p>
                  </div>
                `;
              });
              inner += `</div>`;
            } else {
              inner += `<p class="mt-4 text-[11px] text-gray-300 text-center">
                Aucune activité
              </p>`;
            }
          }

          cell.innerHTML = inner;

          if (!beforeStart) {
            if (!beforeStart) {
  cell.addEventListener("click", () => {
    window.location.href = `activite.html?date=${isoDate}`;
  });
}

          }

          grid.appendChild(cell);
        }
      }

      function updateTime() {
        const now = new Date();
        const h = String(now.getHours()).padStart(2, "0");
        const m = String(now.getMinutes()).padStart(2, "0");
        timeLabel.textContent = `Heure actuelle : ${h}h${m}`;
      }

      prevBtn.addEventListener("click", () => {
        current.setMonth(current.getMonth() - 1);
        renderCalendar();
      });

      nextBtn.addEventListener("click", () => {
        current.setMonth(current.getMonth() + 1);
        renderCalendar();
      });

      renderCalendar();
      updateTime();
      setInterval(updateTime, 60 * 1000);
    </script>
  </body>
</html>
